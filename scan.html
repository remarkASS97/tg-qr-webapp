<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>QR Scanner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Telegram WebApp API -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- QR scanner -->
    <script src="https://unpkg.com/html5-qrcode"></script>

    <style>
        body {
            margin: 0;
            background: black;
            color: white;
            font-family: Arial, sans-serif;
        }
        #status {
            position: fixed;
            top: 10px;
            width: 100%;
            text-align: center;
            z-index: 10;
            font-size: 18px;
        }
        #reader {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>

<div id="status">üì∑ –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥</div>
<div id="reader"></div>

<script>
    const tg = Telegram.WebApp;
    tg.expand();

    let scanned = false;

    const scanner = new Html5Qrcode("reader");

    scanner.start(
        { facingMode: "environment" },
        {
            fps: 15,
            qrbox: { width: 280, height: 280 }
        },
        (decodedText) => {
            if (scanned) return;
            scanned = true;

            document.getElementById("status").innerText =
                "‚úÖ QR —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω:\n" + decodedText;

            // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º QR –≤ –±–æ—Ç–∞
            tg.sendData(decodedText);

            // –¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            setTimeout(() => {
                scanner.stop();
                tg.close();
            }, 700);
        },
        (error) => {
            // –æ—à–∏–±–∫–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
        }
    ).catch(err => {
        document.getElementById("status").innerText =
            "‚ùå –û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã: " + err;
    });
</script>

</body>
</html>

